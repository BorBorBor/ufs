#!/usr/bin/python

import sys
import os
from pwd import getpwnam

sys.path.insert(0, os.path.dirname(os.path.abspath(__file__))+'/../')

from django.core.management import setup_environ

from itkufs import settings

setup_environ(settings)

from itkufs.accounting.models import *
from django.contrib.auth.models import User

group = Group.objects.get(slug=sys.argv[1])
name  = getpwnam(sys.argv[2])[4].split(',')[0]

owner, created = User.objects.get_or_create(username=sys.argv[2], email='%s@samfundet.no' % sys.argv[2])

account, created = Account.objects.get_or_create(group=group, owner=owner, defaults={'name': name, 'type': Account.LIABILITY_ACCOUNT, 'slug': sys.argv[2]})

if created:
    print "Created new account for user %s" % owner
else:
    print "User allready has account!"
