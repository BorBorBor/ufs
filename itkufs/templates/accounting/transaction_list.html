{% extends "accounting/base.html" %}
{% load i18n %}

{% block content %}

<h2>
{% if account %}
    {% trans "Account" %}: &ldquo;{{ account.name }}&rdquo;
{% else %}
    {% trans "Group" %}: &ldquo;{{ group.name }}&rdquo;
{% endif %}
</h2>

<div id="tabs">
<ul>
{% if account %}
    <li><a href="{% url account-summary account.group.slug,account.slug %}">Summary</a></li>
    <li><a href="{% url transaction-list-account account.group.slug,account.slug %}" class="active">Transactions</a></li>
{% else %}
    <li><a href="{% url group-summary group.slug %}">Summary</a></li>
    <li><a href="{% url transaction-list-group group.slug %}" class="active">Transactions</a></li>
{% endif %}
</ul>
</div>

<h3>Transactions</h3>

{% if not transaction_list %}

<p>{% trans "No transactions found." %}</p>

{% else %}

{% include "accounting/transaction_list_menu.html" %}

<table class="tablelist">
    <tr>
        <th>{% trans "Status" %}</th>
        <th>{% trans "Account" %}</th>
        <th>{% trans "Debit" %}</th>
        <th>{% trans "Credit" %}</th>
        <th>{% trans "Details" %}</th>
    </tr>
    {% for t in transaction_list %}
    {% with t.entry_set.all.count as rowspan %}
    <tr class="{% cycle 'evenrow' 'oddrow' as trclass %}
        {% if t.is_rejected %}rejected{% else %}
        {% if not t.is_received %}pending{% endif %}{% endif %}">
        {% for e in t.entry_set.all %}
        {% if forloop.first %}
        <td rowspan="{{ rowspan }}">
                {% blocktrans with t.get_status_display as status and t.last_modified|date:"Y-m-d H:i" as last_modified %}
                {{ status }} at {{ last_modified }}
                {% endblocktrans %}
        </td>
        {% endif %}
        <td class="account">
            {% if is_admin %}
                {% ifnotequal e.account.group group %}
                <a href="{% url group-summary e.account.group.slug %}">{{ e.account.group.name }}</a>:
                {% endifnotequal %}
                <a href="{% url account-summary e.account.group.slug,e.account.slug%}">{{ e.account.name }}</a>
            {% else %}
                {% ifnotequal e.account.group group %}
                {{ e.account.group.name }}:
                {% endifnotequal %}
                {{ e.account.name }}
            {% endif %}
        </td>
        <td class="align_right debit">
            {% if e.debit %}
            {{ e.debit|stringformat:"0.2f" }}
            {% endif %}
        </td>
        <td class="align_right credit">
            {% if e.credit %}
            {{ e.credit|stringformat:"0.2f" }}
            {% endif %}
        </td>
        {% if forloop.first %}
        <td rowspan="{{ rowspan }}" class="details">
            <a href="{% url transaction-details e.account.group.slug,t.id %}">Details</a>
        </td>
        {% endif %}
    </tr>
    <tr class="{{ trclass }}
        {% if t.is_rejected %}rejected{% else %}
        {% if not t.is_received %}pending{% endif %}{% endif %}">
        {% endfor %}
    </tr>
    {% endwith %}
    {% endfor %}
</table>

{% include "accounting/transaction_list_menu.html" %}

{% endif %}

{% endblock %}
