The accounting model
====================


Account groups
--------------

Account groups are basically bars. It is used for grouping the bars own
accounts and the accounts of the bar's members.

In addition to its name it has two integer fields, warn_limit and block_limit,
which can be used to warn and block accounts if their balance is below the
given limit.


User Accounts
-------------

- User accounts have an owner (e.g. a real person).
- The name should be the name of the owner or another nickname to be shown
  (e.g. on the krysselist).
- Type is 'Liability' for all user accounts. Liability is credit owed to the
  owner.
- Active is a flag indicating if the owner still is an active member of the
  bar.
- The balance method gives the accounts balance at any time.


Bar Accounts
------------

Ownership:

Bar accounts do not have an owner, but belongs to a bar, defined by its account
group. Owner is NULL for all bar accounts.


Typical accounts:

Most bars will at least have the two accounts 'Bank' and 'Cash'. Other accounts
may for example be 'Income', 'Expense', 'Inventory' and 'Result'.


Account types:

All accounts got an account type, examples follow:
- 'Asset': 'Bank', 'Cash', 'Inventory', 'Hyttetur 2007' (debit to increase)
- 'Liability': 'Supplier Debt', person accounts (credit to increase)
- 'Equity': 'Capital' (credit to increase), 'Drawing' (debit to increase)
- 'Income': 'Sales Income', 'Interest Revenues' (credit to increase)
- 'Expense': 'Supplies Expense', 'Interest Expenses' (debit to increase)
See Wikipedia_ for more information on this.

.. _Wikipedia: http://en.wikipedia.org/wiki/Account


Active account:

Active is a flag indicating if the account is still in use. E.g. if a bar
changes it's real world bank account number, one would maybe create a new
account for it and deactivate the old one.


Transaction between person and the person's account (deposit and withdrawal)
----------------------------------------------------------------------------

Deposits:

OLDER: If from field is NULL and to field a person's account, it is a deposit
from the person to the person's account.

OLD: If from field is a person's account and to field is a bar's bank account,
it is a deposit from the person to the person's account. Note: This gives that
a negative amount on a liability account means that the person has money to
spend. A positive amount means that the person owes the bar money.

NEW: If the credit entry is a person's account and the debit entry is a bar's
bank account, it is a deposit from the person to the person's account. Note:
This gives that a negative amount on a liability account means that the person
has money to spend. A positive amount means that the person owes the bar money.


Withdrawals:

OLDER: If from field is a person's account and the to field is NULL, it is a
withdrawal from the person's account to the person.

OLD: If from field is a bar's bank account and to field is a person's account,
it is a withdrawal from the person's account to the person.

NEW: If the credit entry is a bar's bank account and the debit entry is a
person's account, it is a withdrawal from the person's account to the person.



Null-transactions:

OLDER: A transaction with NULL in both to and from has no meaning and will be
refused by the models save() method.

OLD: Neither from or to allow blank or null, thus this is never a problem.

NEW: All transactions must have positive sums on both the debit and credit
side.


Deposit and withdrawal to/from other persons' accounts:

A person is not allowed to deposit or withdraw from another person's account.
To deposit to another person's account, deposit to you own account and make a
transfer to the other person's account.


Pending transactions:

All users can register deposits and withdrawals, but the recieved/payed date
will not be set before the group admin has approved the transaction and, if
necessary, transfered the money in the real world.

E.g. a user can request a withdrawal by registering it himself. Then the group
admin will transfer the money in the real world bank system, and at last
approve the ÂµFS transaction (that is, set the payed date).


Transaction from account to account within an account group
----------------------------------------------------------

All persons can transfer money to all other persons with the same parent (e.g.
within the same bar). The group admin does not have to approve this.

When a person buys anything from a bar the corresponding sum will be registered
as a transaction between the person's account and the bar's sale account.


Transaction from account to account in another account group
------------------------------------------------------------

A group admin can transfer money, end-to-end, from accounts in his own account
group to accounts in other account groups, typically to the 'Bank' or 'Cash'
accounts. This is usually done as part of a settlement, see below.

One the sending side, each user can check what he has spent at every other bar
between two settlements. On the receiving side, the bars are not interested in
what persons the payment comes from, only that a bar has payed, so in the views
we want combine payments by account groups.


Settlement
----------

Settlement is an optional part of an transaction to group a set of
transactions. It is intended for BSF and similar settlements between bars
(account groups). Its only field is a date and comment.


:Authors: Stein Magnus Jodal, Thomas Adamcik
:Version: 2007-12-11-1
